<!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro</title>
    <link rel="stylesheet" href="estilos.css">
</head>
<body>
    <div class="container">
        <div class="button-group">
            <a href="/" class="btn-secondary">
                <button onclick="" type="button" class="btn-back">Regresar</button>
            </a>
        </div>
        <div class="title" style="color: rgb(255, 123, 0);">Registro</div>
        <form id="form-validation" novalidate>
            <div class="form-group">
                <span>Nombre</span>
                <input type="text" name="nombre" placeholder="Ingrese Nombre" required>
                <small>Por favor ingrese Nombre</small>
            </div>
            <div class="form-group">
                <span>Usuario</span>
                <input type="text" name="usuario" placeholder="Ingrese Usuario" required>
                <small>Por favor ingrese Usuario</small>
            </div>
            <div class="form-group">
                <span>Email</span>
                <input type="email" name="correo" placeholder="Ingrese Correo" required>
                <small>Por favor ingrese correo válido</small>
            </div>
            <div class="form-group">
                <span>Teléfono</span>
                <input type="tel" name="telefono" placeholder="Ingrese Teléfono" required pattern="[0-9]{7,10}">
                <small>Por favor ingrese Teléfono</small>
            </div>
            <div class="form-group">
                <span>Contraseña</span>
                <input type="password" name="contrasena" placeholder="Ingrese Contraseña" required>
                <small>Por favor ingrese Contraseña</small>
            </div>
            <div class="form-group">
                <span>Confirmar Contraseña</span>
                <input type="password" name="confirm_contrasela" placeholder="Confirme Contraseña" required>
                <small>Por favor confirme la contraseña</small>
            </div>
            <div class="button">
                <input type="submit" value="Registrarse">
            </div>
        </form>
    </div>

    <script>
    const addForm = document.getElementById("form-validation");
    addForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        e.stopPropagation();

        // Validación del formulario
        if (addForm.checkValidity() === false) {
            addForm.classList.add('was-validated');
            return false;
        }

        // Validar que las contraseñas coincidan
        const password = document.querySelector('input[name="contrasena"]').value;
        const confirmPassword = document.querySelector('input[name="confirm_contrasena"]').value;
        
        if (password !== confirmPassword) {
            alert('Las contraseñas no coinciden');
            return;
        }

        // Recolectar datos del formulario
        const formData = new FormData(addForm);
        const data = Object.fromEntries(formData);
        
        // Eliminar confirm_password ya que no lo necesitamos en la BD
        delete data.confirm_contrasena;

        try {
        // ✅ CAMBIO: nueva ruta de API
        const response = await fetch('/api/auth/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });

            const result = await response.json();

            if (response.ok) {
               // alert('Registro exitoso');--------nose
                //talves-----------
                window.location.href = '/login';
                //------------------------------
                // Redirigir o limpiar el formulario
                addForm.reset();
                addForm.classList.remove('was-validated');
            } else {
                alert(result.message || 'Error en el registro');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error de conexión');
        }
    });
    </script>
</body>
</html>



